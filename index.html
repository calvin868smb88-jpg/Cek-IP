<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Multi-Fungsi</title>
    <style>
        /* ==================== A. CSS DASAR & BACKGROUND ==================== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('https://infomancingduit.com/wp-content/uploads/2024/12/MANCING.png');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            min-height: 100vh;
            color: #444;
        }
        /* ==================== BARU: CSS Login/Register ==================== */
        #auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        .auth-box {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transition: all 0.5s ease;
        }
        .auth-box h2 {
            color: #FFD700;
            text-shadow: 0 0 5px #FFD700;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        .auth-box input {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .auth-box button {
            width: 100%;
            padding: 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-bottom: 10px;
        }
        .auth-box button:hover {
            background-color: #218838;
        }
        .auth-box p {
            margin-top: 20px;
            color: #666;
        }
        .auth-box a {
            color: #007bff;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
        }
        .auth-box a:hover {
            text-decoration: underline;
        }
        /* ==================== B. CSS SIDEBAR/MENU ==================== */
        #sidebar {
            width: 250px;
            background-color: rgba(34, 34, 34, 0.95);
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100%;
            color: white;
            z-index: 100;
        }
        #sidebar .logo {
            width: 80%;
            height: auto;
            margin: 0 auto 15px auto;
            display: block;
        }
        #sidebar h2 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 30px;
            text-shadow: 0 0 5px #FFD700;
        }
        .menu-item {
            padding: 15px 20px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            border-bottom: 1px solid #333;
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
        }
        .menu-item:hover, .menu-item.active {
            background-color: #555;
            color: #FFD700;
        }
        /* BARU: CSS Logout Button di Sidebar */
        #logout-btn {
            margin-top: auto;
            padding: 15px 20px;
            background-color: #dc3545;
            color: white;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            border-top: 1px solid #555;
        }
        #logout-btn:hover {
            background-color: #c82333;
        }
        /* ==================== C. CSS KONTEN UTAMA (Container) ==================== */
        #main-container {
            flex-grow: 1;
            margin-left: 250px;
            padding: 20px;
            box-sizing: border-box;
        }
        .content-panel {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        /* ==================== G. CSS USER MANAGEMENT (BARU) ==================== */
        #content-users h2 { color: #8b0000; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        #user-list table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        #user-list th, #user-list td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        #user-list th { background-color: #f2f2f2; color: #333; font-weight: bold; }
        .master-role { background-color: #ffc; font-weight: bold; }
        .edit-user-btn {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .edit-user-btn:hover { background-color: #0056b3; }
        #edit-form-container {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
        #edit-form-container input[type="text"], #edit-form-container input[type="password"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #edit-form-container button {
            padding: 10px 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        /* (Sisa CSS dari CEK IP, PREDIKSI BOLA, HISTORY IP diabaikan di sini untuk fokus pada perubahan,
           tetapi dalam file HTML lengkap, mereka tetap ada) */
    </style>
</head>
<body>
    <div id="auth-container">
        <div id="login-box" class="auth-box" style="display: none;">
            <h2>LOGIN KE DASHBOARD</h2>
            <input type="text" id="loginUsername" placeholder="Username" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button onclick="loginUser()">LOGIN</button>
            <p id="loginMessage" style="color: red;"></p>
            <p>Belum punya akun? <a onclick="showRegister()">Daftar Sekarang</a></p>
        </div>

        <div id="register-box" class="auth-box">
            <h2>REGISTRASI AKUN BARU</h2>
            <input type="text" id="registerUsername" placeholder="Username Baru" required>
            <input type="password" id="registerPassword" placeholder="Password Baru" required>
            <button onclick="registerUser()">REGISTRASI</button>
            <p id="registerMessage" style="color: red;">Gagal menyimpan data. Coba lagi.</p>
            <p>Sudah punya akun? <a onclick="showLogin()">Login</a></p>
        </div>
    </div>
    <div id="sidebar" style="display: none;">
        <img src="https://i.postimg.cc/8PMP5890/logo.png" alt="Logo Mancing Duit" class="logo">

        <a href="#" class="menu-item active" data-content="cek-ip" id="menu-cek-ip">üîç Cek IP</a>
        <a href="#" class="menu-item" data-content="history-cek-ip" id="menu-history-cek-ip">üìú HISTORY CEK IP</a>
        <a href="#" class="menu-item" data-content="prediksi-bola" id="menu-prediksi-bola">‚öΩ PREDIKSI BOLA</a>
        
        <a href="#" class="menu-item" data-content="users" id="menu-users" style="display: none;">üë®‚Äçüíª MANAJEMEN USER</a>

        <div id="logout-btn" onclick="logoutUser()">KELUAR (LOGOUT)</div>
    </div>
    <div id="main-container" style="display: none;">
        <div id="content-cek-ip" class="content-panel">...Konten Cek IP...</div>
        <div id="content-history-cek-ip" class="content-panel" style="display: none;">...Konten History...</div>
        <div id="content-prediksi-bola" class="content-panel" style="display: none;">...Konten Prediksi Bola...</div>

        <div id="content-users" class="content-panel" style="display: none;">
            <h2>üë®‚Äçüíª Manajamen Data Staff</h2>
            <p style="color: red; font-weight: bold;">‚ö†Ô∏è HANYA ADMIN MASTER YANG BISA MELIHAT & MENGEDIT DATA INI.</p>

            <h3>Daftar Pengguna:</h3>
            <div id="user-list">
                <p>Memuat data pengguna...</p>
            </div>

            <div id="edit-form-container" style="display: none;">
                <h3>Edit Pengguna: <span id="editing-username-display" style="color: #007bff;"></span></h3>
                <label for="editPassword">Password Baru (Kosongkan jika tidak diubah):</label>
                <input type="password" id="editPassword" placeholder="Password Baru">
                
                <label for="editRole">Peran (Role):</label>
                <select id="editRole" style="padding: 10px; margin-bottom: 10px; width: 100%;">
                    <option value="staf">Staf</option>
                    <option value="master">Admin Master</option>
                </select>
                
                <button onclick="saveEditedUser()">Simpan Perubahan</button>
                <button style="background-color: #6c757d;" onclick="document.getElementById('edit-form-container').style.display = 'none';">Batal</button>
                <p id="editMessage" style="color: green; margin-top: 10px;"></p>
            </div>
        </div>
        </div>
    <script>
        // Key untuk menyimpan data user
        const USER_STORAGE_KEY = 'dashboardUsers';
        // Key untuk status login
        const LOGGED_IN_KEY = 'isLoggedIn';
        // Variabel global untuk menyimpan username yang sedang di-edit
        let editingUsername = null; 

        // Fungsi untuk mereset semua input di dashboard
        function resetDashboardInputs() {
            // ... (Fungsi ini tetap sama, mereset semua input) ...
            const registerUsername = document.getElementById('registerUsername');
            const registerPassword = document.getElementById('registerPassword');
            const loginUsername = document.getElementById('loginUsername');
            const loginPassword = document.getElementById('loginPassword');

            if(registerUsername) registerUsername.value = '';
            if(registerPassword) registerPassword.value = '';
            if(loginUsername) loginUsername.value = '';
            if(loginPassword) loginPassword.value = '';
            
            const regMsg = document.getElementById('registerMessage');
            const logMsg = document.getElementById('loginMessage');
            if(regMsg) regMsg.textContent = '';
            if(logMsg) logMsg.textContent = '';
        }

        // ==================== SCRIPT AUTHENTICATION (Login/Register) ====================

        function showLogin() {
            document.getElementById('register-box').style.display = 'none';
            document.getElementById('login-box').style.display = 'block';
            resetDashboardInputs(); 
        }

        function showRegister() {
            document.getElementById('login-box').style.display = 'none';
            document.getElementById('register-box').style.display = 'block';
            resetDashboardInputs(); 
        }

        // FUNGSI INI DIUBAH: Sekarang mengembalikan objek {username: {password, role}, ...}
        function getUsers() {
            try {
                const usersJson = localStorage.getItem(USER_STORAGE_KEY);
                // Jika tidak ada data, kembalikan objek kosong
                return usersJson ? JSON.parse(usersJson) : {};
            } catch (e) {
                console.error("Gagal memuat pengguna:", e);
                return {};
            }
        }

        function registerUser() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const messageDiv = document.getElementById('registerMessage');

            messageDiv.style.color = 'red'; 
            messageDiv.textContent = '';

            if (username.length < 4 || password.length < 6) {
                messageDiv.textContent = 'Username minimal 4 karakter, Password minimal 6 karakter.';
                return;
            }

            const users = getUsers();

            if (users[username]) {
                messageDiv.textContent = 'Username sudah terdaftar. Silakan gunakan yang lain.';
                return;
            }

            // Tentukan Peran (Role): Pengguna pertama yang mendaftar menjadi 'master'
            const role = Object.keys(users).length === 0 ? 'master' : 'staf';

            // Simpan sebagai objek: {password: '...', role: '...'}
            users[username] = { password: password, role: role };

            try {
                localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(users));
                messageDiv.style.color = 'green';
                messageDiv.textContent = 'Registrasi Berhasil! Anda adalah ' + (role === 'master' ? 'Admin Master' : 'Staf') + '. Silakan Login.';
                
                document.getElementById('registerUsername').value = '';
                document.getElementById('registerPassword').value = '';
                setTimeout(showLogin, 1500); 
            } catch (e) {
                messageDiv.style.color = 'red';
                messageDiv.textContent = `‚ùå Gagal menyimpan data: ${e.name}. Coba lagi.`;
                console.error("LOCAL STORAGE ERROR:", e);
            }
        }

        function loginUser() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const messageDiv = document.getElementById('loginMessage');

            messageDiv.style.color = 'red';
            messageDiv.textContent = '';

            if (!username || !password) {
                messageDiv.textContent = 'Username dan Password harus diisi.';
                return;
            }

            const users = getUsers();
            const user = users[username];

            // Cek pengguna ada dan password cocok
            if (user && user.password === password) {
                // Login Berhasil
                // Simpan status login dan PERAN (ROLE) pengguna
                localStorage.setItem(LOGGED_IN_KEY, 'true');
                localStorage.setItem('currentRole', user.role); 

                messageDiv.style.color = 'green';
                messageDiv.textContent = `Login Berhasil sebagai ${user.role.toUpperCase()}! Memuat Dashboard...`;
                setTimeout(checkLoginStatus, 500);
            } else {
                messageDiv.textContent = 'Username atau Password salah.';
            }
        }

        function logoutUser() {
            localStorage.removeItem(LOGGED_IN_KEY); 
            localStorage.removeItem('currentRole'); // Hapus peran saat logout
            
            document.getElementById('auth-container').style.display = 'flex';
            document.getElementById('sidebar').style.display = 'none';
            document.getElementById('main-container').style.display = 'none';
            document.getElementById('menu-users').style.display = 'none'; // Pastikan menu user hilang
            
            resetDashboardInputs(); 
            alert("Anda telah berhasil Logout.");
            showLogin();
        }

        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem(LOGGED_IN_KEY) === 'true';
            const currentRole = localStorage.getItem('currentRole'); // Ambil peran
            
            const authContainer = document.getElementById('auth-container');
            const sidebar = document.getElementById('sidebar');
            const mainContainer = document.getElementById('main-container');
            const menuUsers = document.getElementById('menu-users');

            if (isLoggedIn) {
                authContainer.style.display = 'none';
                sidebar.style.display = 'flex';
                mainContainer.style.display = 'block';

                // LOGIKA BARU: Tampilkan Menu User hanya jika Admin Master
                if (currentRole === 'master') {
                    menuUsers.style.display = 'block';
                } else {
                    menuUsers.style.display = 'none';
                }

                document.getElementById('logInput').value = '';
                document.getElementById('input').value = '';
            } else {
                authContainer.style.display = 'flex';
                sidebar.style.display = 'none';
                mainContainer.style.display = 'none';
                menuUsers.style.display = 'none';
                
                const users = getUsers();
                if (Object.keys(users).length === 0) {
                    showRegister();
                } else {
                    showLogin();
                }
            }
        }
        // ==================== END SCRIPT AUTHENTICATION ====================


        // --- 1. SCRIPT PENGATUR MENU (CONTENT SWITCHING) ---
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();

                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.content-panel').forEach(p => p.style.display = 'none');

                const targetId = 'content-' + this.getAttribute('data-content');
                const targetPanel = document.getElementById(targetId);
                if (targetPanel) {
                    targetPanel.style.display = 'block';
                }

                // PANGGIL FUNGSI KHUSUS UNTUK MENU USERS
                if (this.getAttribute('data-content') === 'users') {
                    // Hanya Master yang bisa memuat daftar pengguna
                    if (localStorage.getItem('currentRole') === 'master') {
                        loadUserList();
                    }
                }
            });
        });

        // --- 2. SCRIPT RESET INPUT KETIKA REFRESH ---
        window.onload = function() {
            resetDashboardInputs(); 
            checkLoginStatus(); 
            
            // Atur tampilan awal ke Cek IP
            document.getElementById('content-cek-ip').style.display = 'block';
            document.getElementById('menu-cek-ip').classList.add('active');
        };

        // ==================== BARU: SCRIPT MANAJEMEN USER ====================

        function loadUserList() {
            const users = getUsers();
            const userListDiv = document.getElementById('user-list');

            let html = '<table>';
            html += '<thead><tr><th>Username</th><th>Peran (Role)</th><th>Aksi</th></tr></thead>';
            html += '<tbody>';

            // Iterasi melalui pengguna
            for (const username in users) {
                const user = users[username];
                const rowClass = user.role === 'master' ? 'class="master-role"' : '';
                
                html += `<tr ${rowClass}>`;
                html += `<td>${username}</td>`;
                html += `<td>${user.role.toUpperCase()}</td>`;
                html += `<td><button class="edit-user-btn" onclick="openEditForm('${username}')">Edit</button></td>`;
                html += '</tr>';
            }

            html += '</tbody></table>';
            userListDiv.innerHTML = html;
            
            // Sembunyikan form edit saat list dimuat
            document.getElementById('edit-form-container').style.display = 'none';
        }

        function openEditForm(username) {
            const users = getUsers();
            const user = users[username];
            
            if (!user) {
                alert('Pengguna tidak ditemukan.');
                return;
            }

            editingUsername = username; // Set username yang sedang di-edit
            
            document.getElementById('editing-username-display').textContent = username;
            document.getElementById('editRole').value = user.role;
            document.getElementById('editPassword').value = ''; // Kosongkan password field
            document.getElementById('editMessage').textContent = '';
            
            document.getElementById('edit-form-container').style.display = 'block';
        }

        function saveEditedUser() {
            if (!editingUsername) return;

            const newPassword = document.getElementById('editPassword').value.trim();
            const newRole = document.getElementById('editRole').value;
            const messageDiv = document.getElementById('editMessage');
            
            let users = getUsers();
            let userToEdit = users[editingUsername];

            if (!userToEdit) {
                 messageDiv.style.color = 'red';
                 messageDiv.textContent = 'Gagal menyimpan: Pengguna tidak ditemukan.';
                 return;
            }

            // 1. Update Password (jika diisi)
            if (newPassword.length > 0) {
                if (newPassword.length < 6) {
                    messageDiv.style.color = 'red';
                    messageDiv.textContent = 'Password baru minimal 6 karakter.';
                    return;
                }
                userToEdit.password = newPassword;
            }

            // 2. Update Role
            userToEdit.role = newRole;

            // Simpan kembali ke localStorage
            users[editingUsername] = userToEdit;

            try {
                localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(users));
                messageDiv.style.color = 'green';
                messageDiv.textContent = `Data ${editingUsername} berhasil diperbarui!`;
                
                // Muat ulang daftar dan sembunyikan form setelah 1 detik
                setTimeout(() => {
                    loadUserList(); 
                    document.getElementById('edit-form-container').style.display = 'none';
                    editingUsername = null;
                }, 1000);

            } catch (e) {
                messageDiv.style.color = 'red';
                messageDiv.textContent = `‚ùå Gagal menyimpan data: ${e.name}. Coba lagi.`;
                console.error("LOCAL STORAGE ERROR:", e);
            }
        }
        
        // (Sisa script untuk CEK IP, HISTORY IP, PREDIKSI BOLA disisipkan di sini. Karena fungsionalitasnya tidak berubah, saya tidak mencantumkannya untuk menghemat ruang.)
        /*
        // --- 3. SCRIPT CEK IP (Fungsionalitas) ---
        // ... (kode processData, parseRawData, analyzeLoginData, renderResults) ...
        // --- 4. SCRIPT RIWAYAT (Fungsionalitas History) ---
        // ... (kode getHistory, saveHistory, loadHistory, clearHistory) ...
        // --- 5. SCRIPT PREDIKSI BOLA (Fungsionalitas) ---
        // ... (kode generateTable, copyHTML) ...
        */
        
        // --- Sisipkan kode Cek IP, History, dan Prediksi Bola di bawah ini ---
        // Karena kode Cek IP, History, dan Prediksi Bola yang lengkap cukup panjang,
        // diasumsikan Anda akan menyalin kembali kode tersebut ke dalam <script> di atas
        // agar semua fungsionalitas berjalan dengan baik bersama fitur User Management yang baru.
        
        // Contoh penempatan kode Cek IP/Prediksi Bola:
        const THRESHOLD = 3; 
        function processData() { /* ... kode cek ip ... */ }
        function parseRawData(rawData) { /* ... */ }
        function analyzeLoginData(data) { /* ... */ }
        function renderResults(results) { /* ... */ }
        
        const HISTORY_STORAGE_KEY = 'ipCheckHistory';
        function getHistory() { /* ... */ }
        function saveHistory(status) { /* ... */ }
        function loadHistory() { /* ... */ }
        function clearHistory() { /* ... */ }
        
        function generateTable() { /* ... kode prediksi bola ... */ }
        function copyHTML() { /* ... */ }

    </script>
</body>
</html>
